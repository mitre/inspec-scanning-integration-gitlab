
.ci:stage:saf:verify:
  image:
    name: mitre/saf
    entrypoint: [""]
  stage: verify
  script:
      - echo "Running summary reports"
      - echo "Vanilla"
      - saf view:summary -i $CI_PROJECT_DIR/reports/raw/vanilla*.json -j -o $CI_PROJECT_DIR/reports/raw/$CI_PIPELINE_ID-vanilla-summary.json;

      - echo "Hardened"
      - saf view:summary -i $CI_PROJECT_DIR/reports/raw/hardened*.json -j -o $CI_PROJECT_DIR/reports/raw/$CI_PIPELINE_ID-hardened-summary.json;

      - echo "Verifying thresholds were met"
      - saf validate:threshold -i $CI_PROJECT_DIR/reports/raw/vanilla*.json -F ./vanilla.threshold.yml;
      - saf validate:threshold -i $CI_PROJECT_DIR/reports/raw/hardened*.json -F ./hardened.threshold.yml;
