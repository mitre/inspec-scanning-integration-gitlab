.ci:stage:check:inspec:
  image:
      name: $REGISTRY/ci/inspec-dev:$INSPEC_PIPELINE_TAG
      entrypoint: [""]
  variables:
    CHEF_LICENSE: 'accept-silent'
  stage: verify
  before_script:
    - export CI_JOB_TIMESTAMP=$(date --utc --iso-8601=seconds)
  script:
    - inspec check . --format=json > reports/raw/check-results.json
    - writer $CI_PROJECT_DIR/reports/raw/check-results.json $CI_PROJECT_DIR/reports/pipeline/check-results.json
  allow_failure: true
  artifacts:
    when: always
    paths:
        - $CI_PROJECT_DIR/reports/raw/check-results.json
        - $CI_PROJECT_DIR/reports/pipeline/check-results.json
  tags:
    - docker
